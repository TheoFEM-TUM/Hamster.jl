<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Fitting a Delta-ML model on data from MD · Hamster</title><meta name="title" content="Fitting a Delta-ML model on data from MD · Hamster"/><meta property="og:title" content="Fitting a Delta-ML model on data from MD · Hamster"/><meta property="twitter:title" content="Fitting a Delta-ML model on data from MD · Hamster"/><meta name="description" content="Documentation for Hamster."/><meta property="og:description" content="Documentation for Hamster."/><meta property="twitter:description" content="Documentation for Hamster."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Hamster logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Hamster</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Config File</span><ul><li><a class="tocitem" href="../../conf/config/">Main Input File</a></li><li><a class="tocitem" href="../../conf/general_tags/">General Options</a></li><li><a class="tocitem" href="../../conf/block_tags/">Config Blocks</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/">Overview</a></li><li><a class="tocitem" href="../model_eval/">Standard run for GaAs</a></li><li><a class="tocitem" href="../gaas_tb_hyperopt/">TB Hyperparameter optimization for GaAs</a></li><li class="is-active"><a class="tocitem" href>Fitting a Delta-ML model on data from MD</a><ul class="internal"><li><a class="tocitem" href="#Supercell-block"><span>Supercell block</span></a></li><li><a class="tocitem" href="#ML-block"><span>ML block</span></a></li><li><a class="tocitem" href="#Optimization"><span>Optimization</span></a></li><li><a class="tocitem" href="#Output"><span>Output</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../library/library/">Library</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Fitting a Delta-ML model on data from MD</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Fitting a Delta-ML model on data from MD</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/TheoFEM-TUM/Hamster.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/TheoFEM-TUM/Hamster.jl/blob/master/docs/src/examples/gaas_ml_fit.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="mdfit-gaas"><a class="docs-heading-anchor" href="#mdfit-gaas">Fitting a Delta-ML model on data from MD</a><a id="mdfit-gaas-1"></a><a class="docs-heading-anchor-permalink" href="#mdfit-gaas" title="Permalink"></a></h1><p>This example demonstrates how to fit a Δ-ML model on top of an existing TB parameterization for GaAs. While all Hamiltonian components (TB, ML, SOC) can in principle be optimized simultaneously, it is significantly more stable to fit them separately.</p><p>To this end, we will use eigenvalue data (provided by <code>eigenval.h5</code>) from an MD trajectory (provided by <code>structures.h5</code>) computed with VASP. A <code>POSCAR</code> file (e.g., initial structure of the MD run) is also required to provide atom species information and reference positions. Inputs file can be found <a href="https://github.com/TheoFEM-TUM/Hamster.jl/tree/main/examples/gaas_ml_fit">here</a>.</p><h2 id="Supercell-block"><a class="docs-heading-anchor" href="#Supercell-block">Supercell block</a><a id="Supercell-block-1"></a><a class="docs-heading-anchor-permalink" href="#Supercell-block" title="Permalink"></a></h2><p>The <code>supercell</code> block tells <code>Hamster</code> to analyze multiple structures.   The keywords <code>poscar</code> and <code>xdatcar</code> specify the reference <code>POSCAR</code> file and the trajectory file (<code>XDATCAR</code> or <code>*.h5</code>).  </p><p>The selection of structures is controlled by:  </p><ul><li><code>nconf</code>: Number of structures to sample.  </li><li><code>nconf_min</code>: Minimum trajectory index (optional, default = 1).  </li><li><code>nconf_max</code>: Maximum trajectory index (required).</li></ul><h2 id="ML-block"><a class="docs-heading-anchor" href="#ML-block">ML block</a><a id="ML-block-1"></a><a class="docs-heading-anchor-permalink" href="#ML-block" title="Permalink"></a></h2><p>The ML model uses a Gaussian kernel to interpolate between a set of descriptor vectors of Hamiltonian matrix elements.   In practice, it is recommended to perform hyperparameter optimization for the ML model.  </p><p><strong>Sampling of descriptor vectors</strong> is controlled by:  </p><ul><li><code>npoints</code>: Number of descriptor vectors to sample.  </li><li><code>ncluster</code>: Number of clusters used in k-means clustering.  </li></ul><p><strong>Kernel model parameters</strong> can be modified via:  </p><ul><li><code>sim_params</code>: Kernel width.  </li><li><code>env_scale</code>: Scaling factor applied only to the environment value.  </li><li><code>apply_distortion</code>: If enabled, all values in the descriptor vector are updated according to distorted atomic positions.</li></ul><h2 id="Optimization"><a class="docs-heading-anchor" href="#Optimization">Optimization</a><a id="Optimization-1"></a><a class="docs-heading-anchor-permalink" href="#Optimization" title="Permalink"></a></h2><p>Both <code>train_mode</code> and <code>val_mode</code> should be set to <code>md</code>. The optimization can be parallelized over the number of structures using MPI. Set <code>update_tb</code> to <code>false</code> so that only the ML parameters are updated. Using a small learning rate (e.g., 0.01) is recommended to improve optimization stability.</p><h2 id="Output"><a class="docs-heading-anchor" href="#Output">Output</a><a id="Output-1"></a><a class="docs-heading-anchor-permalink" href="#Output" title="Permalink"></a></h2><p>The ML model parameters are written to a file <code>ml_params.dat</code>. The training and validation losses are found in the output file <code>hamster_out.h5</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../gaas_tb_hyperopt/">« TB Hyperparameter optimization for GaAs</a><a class="docs-footer-nextpage" href="../../library/library/">Library »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Wednesday 8 October 2025 07:18">Wednesday 8 October 2025</span>. Using Julia version 1.12.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
